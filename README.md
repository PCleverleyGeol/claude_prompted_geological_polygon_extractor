Geological Map polygon extract to GeoJSON
This is illustrative REACT code from a few minutes prompting using Claude 4.5 Sonnet Large Language Model (LLM). This is not production ready code.
Dr Paul H Cleverley (Nov 5th 2025)

README text generated by Claude 4.5 Sonnet from a prompt, with some of my additional comments included

Geological Map Extractor
A web-based tool for digitizing geological maps by extracting rock formations as georeferenced polygons from scanned map images.
Features

Image Loading: Upload scanned geological maps (PNG, JPG, etc.)
Coordinate Calibration: Georeference maps using DMS (Degrees, Minutes, Seconds) or Decimal coordinates
Color-Based Extraction: Extract rock formations by selecting their map colors
Polygon Smoothing: Douglas-Peucker algorithm for clean, professional boundaries
GeoJSON Export: Export georeferenced polygons for use in GIS software
Interactive Controls: Pan, zoom, and preview extracted polygons

Quick Start Guide
1. Load Your Geological Map (image file)

Click the "Load" button (top right)
Select your geological map image file
The map will appear in the canvas below

2. Calibrate Coordinates
Important: Accurate calibration is critical for proper georeferencing!
An OCR Tesseract library is included to automatically read Latitude/Longitude but does not run well with Claude
Use Python environment if you want to use this.
So a manual option is also added where you need to add 4 points.

Click the "Coords" button
Click "Calibrate" to enter calibration mode
For each axis tick mark on your map:

Select coordinate type (Longitude or Latitude)
Enter the DMS values (degrees, minutes, seconds, direction)
Click the tick mark location on the map
The point is automatically saved


Minimum required: 2 longitude points + 2 latitude points
Assumes that tick marks are never in the corner of the map (or rarely) so just calibrate each end point tick mark on the axes
Click "Done Calibrating" when finished
Click "Test" to verify calibration is working (it will generate a decimal lat long point for the center of the image as a sanity check)
You need 4 axes points to calibrate, assmes these will be in degrees, minutes and seconds. For last (fourth) point, click 'Done calibrating' to save.
Click "Close" to exit coordinate panel

Calibration Tips:

Use the outermost tick marks for best accuracy
Always verify the hemisphere: N/S for latitude, E/W for longitude
Example for Namibia: 15°E 25°S (not 15°W!)
The test result should show coordinates in the correct region

3. Extract Rock Formations

Click "Pick Colour" button
Click on a rock formation colour in the map
Adjust extraction parameters:

Color Tolerance (10-40): How much color variation to include
Min Area (200-500px): Filter out small artifacts
Smoothing (3-5): Higher = smoother boundaries
Merge Gaps (5-10px): Connect nearby regions of same color


Click "Extract" to trace polygons
Repeat for different rock types/colors

4. Export GeoJSON

Click "Export" button
The GeoJSON file will automatically download
It's also copied to your clipboard
Load the .geojson file into:

QGIS
ArcGIS
Google Earth
geojson.io (for quick viewing)



Parameter Guide
Color Tolerance (10-150)

Low (10-20): Extract only exact color matches
Medium (30-50): Include slight color variations (recommended)
High (60-150): Include broad color ranges (may over-extract)

Min Area (50-2000 pixels)

Small (50-200): Keep small features and details
Medium (200-500): Standard for most geological maps
Large (500-2000): Filter out noise, keep only major formations

Smoothing (0.5-10)

Low (0.5-2): Detailed boundaries, may be jagged
Medium (3-5): Balanced - clean yet accurate (recommended)
High (6-10): Very smooth, may lose small details

Merge Gaps (1-20 pixels)

Low (1-5): Keep formations separate
Medium (5-10): Merge nearby regions of same rock type
High (10-20): Aggressively merge fragmented areas

Recommended Settings
For Clean Geological Maps
Color Tolerance: 30
Min Area: 200px
Smoothing: 4
Merge Gaps: 5px
For Noisy/Scanned Maps
Color Tolerance: 40
Min Area: 500px
Smoothing: 5
Merge Gaps: 10px
For Detailed Maps
Color Tolerance: 20
Min Area: 100px
Smoothing: 3
Merge Gaps: 3px
Keyboard Shortcuts

Shift + Click: Pan the map
Mouse Wheel: Zoom in/out (if supported by browser)

Troubleshooting
"Coordinates are all null/NaN in exported GeoJSON"
Solution: Your calibration points have invalid pixel coordinates.

Click "Coords" → "Clear" to remove bad points
Re-calibrate by clicking the map FIRST, then entering values
Verify all points show valid pixel coordinates (not NaN)
Click "Test" to verify calibration works

"Polygons appear in wrong location (ocean, wrong continent)"
Solution: Wrong hemisphere or coordinate values

Check your map's coordinate labels carefully
Verify N/S and E/W directions are correct
Remember:

Egypt/Red Sea: ~35°E, 22°N
Namibia: ~15°E, 25°S
Not 15°W (that's in the Atlantic Ocean!)


Re-calibrate with correct values

"Polygons look jagged/sketchy"
Solution: Increase smoothing parameter

Clear existing polygons
Increase "Smoothing" slider to 4-6
Extract again
Higher smoothing = cleaner boundaries

"Too many small polygons/noise"
Solution: Increase minimum area and merge distance

Increase "Min Area" to 500-1000px
Increase "Merge Gaps" to 8-15px
Clear and extract again

"Missing parts of rock formations"
Solution: Increase color tolerance

Increase "Color Tolerance" to 40-60
This captures color variations in scanned maps
May need to decrease if over-extracting

"Test Calibration shows nothing"
Solution:

Open browser console (F12) to see detailed output
Verify you have at least 2 lon + 2 lat points
Check that points have valid pixel coordinates
Re-calibrate if needed

File Format
Exported GeoJSON Structure
json{
  "type": "FeatureCollection",
  "crs": {
    "type": "name",
    "properties": {
      "name": "urn:ogc:def:crs:OGC:1.3:CRS84"
    }
  },
  "metadata": {
    "calibration_points": 4,
    "has_georeferencing": true,
    "created": "2025-11-06T20:34:12.148Z"
  },
  "features": [
    {
      "type": "Feature",
      "properties": {
        "rock_type": "Unnamed",
        "color_rgb": "219,125,245",
        "polygon_id": 1
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[[lon, lat], [lon, lat], ...]]
      }
    }
  ]
}
Coordinate Reference System

With calibration: WGS84 (EPSG:4326) - standard latitude/longitude
Without calibration: Pixel coordinates (not georeferenced)

Technical Details
Algorithms Used

Color Matching: Euclidean distance in RGB color space
Region Growing: Flood-fill algorithm for connected regions
Morphological Operations: Dilation and erosion for merging nearby regions
Boundary Tracing: Neighbor-based boundary extraction
Simplification: Douglas-Peucker algorithm for polygon smoothing
Georeferencing: Linear interpolation between calibration points

Browser Requirements

Modern web browser (Chrome, Firefox, Safari, Edge)
JavaScript enabled
Minimum 4GB RAM recommended for large images
Screen resolution: 1280x720 or higher recommended

Performance Notes

Maximum region size: 100,000 pixels (prevents browser freeze)
Recommended image size: < 4000x4000 pixels
Processing time: 1-10 seconds depending on image size and complexity
For very large maps, consider splitting into sections

Best Practices
Before Starting

Prepare your map image:

Scan at 300 DPI for good quality
Crop to just the map area (remove legends if separate)
Ensure coordinate grid/tick marks are visible
Save as PNG or JPG


Study the map:

Identify all distinct rock unit colors
Note coordinate system and ranges
Check for color variations due to scanning



During Extraction

Calibrate carefully: This is the most important step!
Start with one color: Test and refine parameters
Work systematically: Extract one rock type at a time
Name your formations: Add rock names in the input field
Save often: Export after each successful extraction

After Export

Verify in GIS: Load GeoJSON into QGIS/ArcGIS
Check coordinates: Ensure polygons appear in correct location
Validate topology: Check for gaps or overlaps
Add attributes: Enrich GeoJSON with additional metadata

Common Geological Map Types
Lithological Maps

Show rock types by color
Use medium tolerance (30-40)
Higher smoothing (4-5) for clean boundaries

Structural Maps

Show faults, folds, lineaments
Lower tolerance (20-30) for precise lines
Lower smoothing (2-3) for detail

Age/Stratigraphic Maps

Show geological time periods
Medium tolerance (30-40)
Standard smoothing (3-4)

Resource Maps

Show mineral deposits, ore bodies
Lower min area (100-200) to capture small deposits
Medium smoothing (3-4)

Limitations

Cannot extract:

Line features (faults, contacts) - only polygons
Point features (strike/dip symbols)
Text labels or legends


Color-based only:

Cannot distinguish rock types with identical colors
Hatching patterns are not recognized


Raster only:

Input must be image file (not vector PDF)


2D projection:

No support for 3D geological models or cross-sections



Tips for Success

High-quality scans matter: Poor scans produce poor results
Test calibration: Always click "Test" before extracting
Start conservative: Begin with lower tolerance/smoothing
Iterate: Adjust parameters and re-extract until satisfied
Document: Keep notes on which parameters worked for which maps
Validate: Always check exported data in GIS software

Support and Troubleshooting
For issues:

Open browser console (F12) for detailed error messages
Check that calibration test shows valid coordinates
Verify image is fully loaded before calibrating
Try different browsers if issues persist
For very large maps, split into smaller sections

Version History

v3.6 (Current): Proper boundary tracing, clean polygon extraction
v3.5: Added boundary point ordering
v3.4: Douglas-Peucker smoothing algorithm
v3.3: Enhanced parameter controls
v3.2: Improved calibration validation
v3.0: Initial public release

Credits
Built with:

React for UI
HTML5 Canvas for rendering
Lucide React for icons
Douglas-Peucker algorithm for simplification
